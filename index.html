<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>rekoriku</title>
    <style>
      :root {
        color-scheme: dark;
        --bg0: #05070c;
        --bg1: #070b14;
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.68);
        --line: rgba(255, 255, 255, 0.14);
        --line2: rgba(255, 255, 255, 0.10);
        --panel: rgba(10, 14, 25, 0.55);
        --panel2: rgba(10, 14, 25, 0.38);
        --shadow: rgba(0, 0, 0, 0.35);
      }

      * { box-sizing: border-box; }

      html, body { height: 100%; }
      body {
        margin: 0;
        color: var(--text);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        background: radial-gradient(1200px 700px at 70% -20%, rgba(110, 155, 255, 0.20), transparent 55%),
                    radial-gradient(900px 600px at 10% 10%, rgba(255, 140, 180, 0.10), transparent 60%),
                    linear-gradient(180deg, var(--bg1), var(--bg0));
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background:
          radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.18), transparent 55%),
          radial-gradient(1px 1px at 40% 60%, rgba(255,255,255,.14), transparent 55%),
          radial-gradient(1px 1px at 70% 30%, rgba(255,255,255,.16), transparent 55%),
          radial-gradient(1px 1px at 85% 80%, rgba(255,255,255,.12), transparent 55%);
        opacity: .6;
      }

      main {
        max-width: 980px;
        margin: 64px auto;
        padding: 0 16px 64px;
      }

      .panel {
        border: 1px solid var(--line);
        background: linear-gradient(180deg, var(--panel), var(--panel2));
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 18px 50px var(--shadow);
        backdrop-filter: blur(10px);
      }

      a { color: inherit; text-underline-offset: 3px; }
      a:hover { opacity: .9; }

      .top {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: wrap;
      }

      h1 {
        margin: 0;
        font-size: 22px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .muted { color: var(--muted); }

      .controls { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

      input[type="search"], select {
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--line);
        background: rgba(0, 0, 0, 0.20);
        color: var(--text);
        outline: none;
      }
      input[type="search"]::placeholder { color: rgba(255,255,255,.5); }
      input[type="search"]:focus, select:focus { border-color: rgba(140, 185, 255, .45); }

      label { display: inline-flex; align-items: center; gap: 8px; }

      .list { margin-top: 14px; display: grid; gap: 12px; }

      .repo {
        border: 1px solid var(--line2);
        background: rgba(0, 0, 0, 0.18);
        border-radius: 14px;
        padding: 14px 14px;
      }
      .repo h3 { margin: 0; font-size: 15px; letter-spacing: 0.02em; }
      .repo p { margin: 8px 0 10px; }
      .meta { display: flex; gap: 10px; flex-wrap: wrap; font-size: 12px; color: var(--muted); }
      .pill { padding: 2px 8px; border-radius: 999px; border: 1px solid var(--line2); background: rgba(0,0,0,.12); }
      .status { margin-top: 10px; font-size: 12px; color: var(--muted); }
    </style>
  </head>
  <body>
    <main>
    <div class="panel">
      <div class="top">
        <div>
          <h1>Public repos</h1>
          <div class="muted">GitHub: <a href="https://github.com/rekoriku">rekoriku</a></div>
        </div>
        <div class="controls">
          <input id="q" type="search" placeholder="Search repos…" autocomplete="off" />
          <select id="sort">
            <option value="updated" selected>Sort: updated</option>
            <option value="stars">Sort: stars</option>
            <option value="name">Sort: name</option>
          </select>
          <label><input id="forks" type="checkbox" /> include forks</label>
        </div>
      </div>

      <div id="status" class="status muted">Loading…</div>
      <div id="list" class="list" aria-live="polite"></div>
    </div>
    </main>

    <script>
      const USER = 'rekoriku';
      const PER_PAGE = 100;

      const elQ = document.getElementById('q');
      const elSort = document.getElementById('sort');
      const elForks = document.getElementById('forks');
      const elStatus = document.getElementById('status');
      const elList = document.getElementById('list');

      let repos = [];
      let lastError = '';

      function fmtDate(iso) {
        try {
          return new Date(iso).toISOString().slice(0, 10);
        } catch {
          return '';
        }
      }

      function repoCard(r) {
        const stars = typeof r.stargazers_count === 'number' ? r.stargazers_count : 0;
        const forks = typeof r.forks_count === 'number' ? r.forks_count : 0;
        const lang = r.language || '';
        const updated = r.updated_at ? fmtDate(r.updated_at) : '';
        const desc = r.description || '';

        const meta = [
          lang ? `<span class="pill">${escapeHtml(lang)}</span>` : '',
          `<span class="pill">★ ${stars}</span>`,
          `<span class="pill">⑂ ${forks}</span>`,
          updated ? `<span class="pill">updated ${updated}</span>` : '',
          r.archived ? `<span class="pill">archived</span>` : '',
          r.fork ? `<span class="pill">fork</span>` : '',
        ].filter(Boolean).join('');

        return `
          <div class="repo">
            <h3><a href="${r.html_url}" target="_blank" rel="noreferrer">${escapeHtml(r.name)}</a></h3>
            ${desc ? `<p class="muted">${escapeHtml(desc)}</p>` : ''}
            <div class="meta">${meta}</div>
          </div>
        `;
      }

      function escapeHtml(s) {
        return String(s)
          .replaceAll('&', '&amp;')
          .replaceAll('<', '&lt;')
          .replaceAll('>', '&gt;')
          .replaceAll('"', '&quot;')
          .replaceAll("'", '&#39;');
      }

      function applyFilterSort() {
        const q = (elQ.value || '').trim().toLowerCase();
        const includeForks = !!elForks.checked;
        const sort = elSort.value;

        let items = repos.slice();
        if (!includeForks) items = items.filter(r => !r.fork);

        if (q) {
          items = items.filter(r => {
            const hay = `${r.name || ''} ${r.description || ''} ${r.language || ''}`.toLowerCase();
            return hay.includes(q);
          });
        }

        items.sort((a, b) => {
          if (sort === 'stars') return (b.stargazers_count || 0) - (a.stargazers_count || 0);
          if (sort === 'name') return String(a.name || '').localeCompare(String(b.name || ''));
          return String(b.updated_at || '').localeCompare(String(a.updated_at || ''));
        });

        elList.innerHTML = items.map(repoCard).join('');

        const base = `${items.length} shown`;
        const err = lastError ? ` · ${lastError}` : '';
        elStatus.textContent = `${base} / ${repos.length} total${err}`;
      }

      async function fetchAllRepos() {
        let page = 1;
        const out = [];
        while (true) {
          const url = `https://api.github.com/users/${USER}/repos?per_page=${PER_PAGE}&page=${page}&type=public&sort=updated`;
          const res = await fetch(url, { headers: { 'Accept': 'application/vnd.github+json' } });
          if (!res.ok) {
            const txt = await res.text().catch(() => '');
            throw new Error(`GitHub API ${res.status}${txt ? `: ${txt}` : ''}`);
          }
          const batch = await res.json();
          if (!Array.isArray(batch) || batch.length === 0) break;
          out.push(...batch);
          if (batch.length < PER_PAGE) break;
          page += 1;
          if (page > 10) break;
        }
        return out;
      }

      async function init() {
        try {
          repos = await fetchAllRepos();
          lastError = '';
        } catch (e) {
          repos = [];
          lastError = (e && e.message) ? e.message : 'Failed to load repos';
        }
        applyFilterSort();
      }

      elQ.addEventListener('input', applyFilterSort);
      elSort.addEventListener('change', applyFilterSort);
      elForks.addEventListener('change', applyFilterSort);

      init();
    </script>
  </body>
</html>
